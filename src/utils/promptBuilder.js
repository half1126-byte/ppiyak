export function buildPrompt(formData) {
    const { mode, tone, age, context, evidence, k_phy, k_com, k_soc, k_art, k_nat, oneDomain, existing } = formData

    const toneGuide = (() => {
        if (tone === "soft") return "부정적 단어는 긍정 방향으로 재구성하고, '점차/시도/도전/키워가고 있음' 같은 완화 표현을 활용하라."
        if (tone === "compact") return "불필요한 수식어를 줄이고, 핵심 행동·근거·의미만 남겨 500자 이내 여유를 확보하라."
        return "평가·단정·진단을 피하고 관찰 가능한 사실 중심으로 서술하라."
    })()

    const detailedRules =
        `[작성 지침]
- 담임교사가 관찰기록(evidence)에 근거해 작성하라.
- 유아 이름/또래 이름은 어떤 형태로도 쓰지 마라.
- '학생은/그는/그녀는' 같은 표현 주체를 쓰지 말고 3인칭 생략형으로 쓰라.
- 총 글자수 500자 이내로 쓰라.
- 문장부호는 마침표(.), 쉼표(,), 중간점(·)만 사용하고 그 외 문장부호는 사용하지 마라.
- 부정 표현은 긍정 방향으로 재구성하라(예: '목소리가 작음' → '표현에 자신감을 키워가고 있음').
- 각 문장 종결은 반드시 '~함/~음/~임'(마침표는 붙어도 됨)으로 끝내라.
- 결과는 줄바꿈 없이 '하나의 문단'으로 출력하라(단, 5개 문장이 명확히 구분되어야 함).`

    const expansionRules =
        `[문장 확장 원칙: 키워드만 있어도 아래 흐름으로 확장]
1. 관찰(Situation/Action): 구체적 상황과 행동 묘사
2. 근거(Evidence): 행동의 이유나 구체적 단서 
3. 의미(Meaning): 발달적 의미 부여
4. 지원(Support): 교사의 지원 내용이나 향후 지도 방향

[영역별 세부 지침]
- 신체: 기본운동, 도구조작, 건강습관(식사/위생/휴식)을 구체 동사로 쓰고 전후 변화를 비교해 서술
- 의사소통: 실제 발화(인용)와 듣기/질문/이야기구성의 수준을 놀이 상황과 함께 기재
- 사회관계: 또래/교사와의 상호작용, 규칙이해, 감정조절/양보/협력 장면을 사실 중심으로 정리
- 예술경험/자연탐구: 표현매체/감상태도/리듬움직임과 관찰/분류/예측/수세기 등 탐구과정을 결과보다 '과정' 중심으로 기록`

    if (mode === "integrated") {
        return (
            `너는 유치원 담임교사의 생활기록부 보조자임.
아래 입력을 바탕으로 유아발달상황을 작성하라.

${detailedRules}
${expansionRules}

[출력 조건]
- 정확히 5문장으로 구성하라.
- 5개 영역(신체·의사소통·사회관계·예술경험·자연탐구)이 각 1문장씩 골고루 드러나게 하라.
- 톤: ${toneGuide}

    const inputBlock =
        `[입력]
            - 연령: ${ age || "(미입력)" }
        - 관찰 맥락: ${ context }
        - 관찰기록 evidence: ${ evidence }
        - 신체운동·건강 키워드: ${ k_phy || "(미입력)" }
        - 의사소통 키워드: ${ k_com || "(미입력)" }
        - 사회관계 키워드: ${ k_soc || "(미입력)" }
        - 예술경험 키워드: ${ k_art || "(미입력)" }
        - 자연탐구 키워드: ${ k_nat || "(미입력)" } `

    if (mode === "integrated") {
        return (
            `너는 유치원 담임교사의 생활기록부 보조자임.
아래 입력을 바탕으로 유아발달상황을 작성하라.

            ${ commonRules }

        [출력 조건]
            - 정확히 5문장으로 구성하라(마침표 기준 5문장).
- 5개 영역(신체운동·건강 / 의사소통 / 사회관계 / 예술경험 / 자연탐구)이 통합적으로 드러나게 하라.
- 문장 구성 권장 흐름:
        1~2문장: 놀이 참여 모습과 신체 조절 또는 탐구성(신체운동·건강, 자연탐구)
        3문장: 또래 / 교사와 상호작용(사회관계, 의사소통)
        4문장: 표현 활동 참여(예술경험, 의사소통)
        5문장: 생활습관 / 태도 / 변화로 마무리(기본생활, 탐구 태도)
            - 톤: ${ toneGuide }

${ inputBlock }

        [출력 예시 형식]
문장1...함.문장2...음.문장3...임.문장4...함.문장5...음.`
        )
    }

    if (mode === "domain_one") {
        return (
            `너는 유치원 담임교사의 생활기록부 보조자임.
아래 입력을 바탕으로 '${oneDomain}' 중심의 문장 1개를 작성하라.

            ${ commonRules }

        [출력 조건]
            - 정확히 1문장만 출력하라.
- 문장 끝은 반드시 '~함/~음/~임'으로 끝내라.
- '${oneDomain}'이 중심이 되되, evidence 근거가 드러나게 하라.
- 톤: ${ toneGuide }

${ inputBlock } `
        )
    }

    if (mode === "rewrite") {
        return (
            `너는 유치원 담임교사의 생활기록부 보조자임.
            아래 '기존 문단'을 지침에 맞게 수정·보완하라.

                ${ commonRules }

        [출력 조건]
            - 결과는 정확히 5문장, 1문단으로 출력하라.
- 5개 영역이 통합적으로 드러나게 하라.
- 기존 문단의 핵심 의미를 유지하되, 규칙 위반(이름 / 문장부호 / 종결 / 3인칭 주체 / 부정표현)을 모두 수정하라.
- 톤: ${ toneGuide }

        [관찰 맥락] ${ context }
        [관찰기록 evidence] ${ evidence }
        [기존 문단] ${ existing || "(미입력)" } `
        )
    }

    // variants mode
    return (
        `너는 유치원 담임교사의 생활기록부 보조자임.
아래 입력을 바탕으로 유아발달상황 '통합 5문장 1문단'을 10개 버전으로 작성하라.

            ${ commonRules }

        [출력 조건]
            - 버전은 10개, 각 버전은 줄바꿈 1회로만 구분하라(버전 내부는 줄바꿈 금지).
- 각 버전은 정확히 5문장(마침표 기준), 1문단이어야 함.
- 각 문장 종결은 '~함/~음/~임'으로 끝나야 함.
- 5개 영역이 매 버전마다 통합적으로 드러나야 함.
- 톤: ${ toneGuide }

${ inputBlock }

        [출력 예시]
            (1) ...함. ...음. ...임. ...함. ...음.
(2) ...함. ...음. ...임. ...함. ...음.
...`
    )
}
